<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>考试系统</title>
    <meta http-equiv = "X-UA-Compatible" content = "IE=edge,chrome=1" />
    <link rel="shortcut icon" href="/static/images/logo.jpg"  />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="stylesheet" type="text/css" href="https://s1.kaoshixing.com/static/plugins/bootstrap/css/bootstrap.min.css?v=9ed71d952357">
    <link rel="stylesheet" type="text/css" href="https://s1.kaoshixing.com/static/plugins/bootgrid/jquery.bootgrid.css?v=34bb33548057">
    <link rel="stylesheet" type="text/css" href="https://s3.kaoshixing.com/static/plugins/pikaday/pikaday.css?v=8e3f4c24fd57">
    <link rel="stylesheet" type="text/css" href="https://s1.kaoshixing.com/static/base/css/ksx-base.css?v=8c544f136f57">
    <link rel="stylesheet" type="text/css" href="https://s1.kaoshixing.com/static/plugins/IconFont/css/styles.min.css?v=155b8a0f0957">
    <link rel="stylesheet" type="text/css" href="https://s0.kaoshixing.com/static/base/css/modal_content_style.css?v=5e0aae2c9a57">
    <style>

      .toolbarBottom{
        clear: both;
      }
      a#selTypeLink {
        display: inline-block;
        width: 220px;
        overflow: hidden;
        text-overflow:ellipsis;
        white-space: nowrap;
      }
      /*.tab-content .tab-pane .com-drop{*/
      /*min-height: 600px;*/
      /*}*/
    </style>
    <style>
      .fade .in{display: none;}
      .btn-group .dropdown:last-child{
        display: none;
      }
      a#selTypeLink {
        display: inline-block;
        border-radius: 4px;
        width: 220px;
        height: 28px;
        line-height: 28px;
        color: #666666;
        background: #F5F5F5;
        text-align: center;
      }
      .topSelDiv .topContent{
        text-align: left;
        padding-left: 30px;
        padding-right: 30px;
      }
    </style>
  </head>

  <body>
    <div>
      <form action="/baseinfo/admin/user/exam_sel_user" name="form" method="get" id="subForm">
        <input type="hidden" class="" name="search" value="true" />
        <div class="topSelDiv">
          <div class="topContent" >
            <div>
              <div class="form-group">
                <label>账号：</label>
                <input type="text" class="modal_input input_item" name="user_name"/>
              </div>
              <div class="form-group">
                <label>姓&nbsp;&nbsp;&nbsp;名：</label>
                <input type="text" class="modal_input input_item" name="surname"/>
              </div>
              <div class="form-group">
                <label>性别：</label>
                <select name="sex" class="modal_select select_item">
                  <option value="" selected>请选择</option>
                  <option value="1">男</option>
                  <option value="0">女</option>
                </select>
              </div>
            </div>
            <div>
              <div class="form-group">
                <label>状态：</label>
                <select name="status" class="modal_select select_item">
                  <option value="" selected>请选择</option>
                  <option value="0">正常</option>
                  <option value="1">禁用</option>
                </select>
              </div>
              <div class="form-group">
                <label>部&nbsp;&nbsp;&nbsp;门：</label>
                <a href="#" id="selTypeLink">
                  <span>选择部门</span><i class="icons8-sort-filled" style="float: right; margin-right: 15px;"></i></a>
                <input type="hidden" class="" name="department_id" value="" />
              </div>
              <div class="form-group">
                <label>职位：</label>
                <input type="text" class="modal_input input_item" name="position"/>
              </div>
            </div>
            <div>
              <div class="form-group">
                <label>手机：</label>
                <input type="text" class="modal_input input_item" name="phone"/>
              </div>
              <div class="form-group">
                <label>证件号：</label>
                <input type="text" class="modal_input input_item" name="identity"/>
              </div>
              <div class="form-group">
                <label>邮箱：</label>
                <input type="text" class="modal_input input_item" name="email"/>
              </div>
            </div>
            <div>
              <div class="form-group">
                <label>备注：</label>
                <input type="text" class="modal_input input_item" name="notice"/>
              </div>
            </div>

            <div class="toolbarBottom">
              <a class="btn modal_btn_default btn_off" href="#" id="resetBtn">重置</a>
              <a class="btn modal_btn_default btn_on" href="#" id="searchBtn">搜索</a>
            </div>
          </div>
          <div role="tabpanel" class="tab-area tab-col2">
            <div class="tab-content">
              <div role="tabpanel" class="tab-pane active">
                <div>
                  <div class="rqm-table2 com-drop">
                    <table id="grid-data" class="table table-condensed table-hover customerTab">
                      <thead>
                        <tr>
                          <!--
                                              <th data-column-id="id" data-visible="false" data-type="numeric" data-identifier="true" data-formatter="id"></th>
                          -->
                          <th data-column-id="id" data-visible="false" data-type="numeric" data-identifier="true"></th>
                          <th data-column-id="userName">账号</th>
                          <th data-column-id="surname">姓名</th>
                          <th data-column-id="departmentName">所属部门</th>
                          <th data-column-id="email">电子邮件</th>
                          <th data-column-id="sex">性别</th>
                          <th data-column-id="status" data-visible="false">状态</th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="buttonP" style="line-height: 60px;">
            <a class="btn modal_btn_default btn_off" href="#" id="closeBtn">关闭</a>
            <a class="btn modal_btn_default btn_on" href="#" id="saveBtn">确定</a>
          </div>
        </div>
      </form>
    </div>
    <div id="typeModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog modal-small" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 id="myModalLabel" class="modal-title">选择部门</h4>
          </div>
          <div class="modal-body">
            <iframe width="100%" height="518px" name="selTypeModal" id="selTypeModal"></iframe>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="https://s3.kaoshixing.com/static/base/js/jquery.min.js?v=8101d596b257"></script>
    <script type="text/javascript" src="https://s5.kaoshixing.com/static/plugins/bootstrap/js/bootstrap.min.js?v=87d37353ad57"></script>
    <script type="text/javascript" src="/static/common/plugins/bootgrid/jquery.bootgrid-ksx.js"></script>
    <script type="text/javascript" src="https://s0.kaoshixing.com/static/admin/js/admin_main.js?v=a2964f524757"></script>
    <script type="text/javascript" src="https://s0.kaoshixing.com/static/plugins/pikaday/moment.js?v=94dde4ec2657"></script>
    <script type="text/javascript" src="https://s1.kaoshixing.com/static/plugins/pikaday/pikaday.js?v=5c81b2646857"></script>
    <script type="text/javascript" src="https://s3.kaoshixing.com/static/plugins/pikaday/pikaday.jquery.js?v=67f9aeffb457"></script>
    <script>
      var user = JSON.parse(window.localStorage.getItem("USER"));
      var expireTime = JSON.parse(window.localStorage.getItem("EXPIRE_TIME"))
      var now = new Date()
      var year = now.getFullYear().toString()
      var month = (now.getMonth()+1).toString().length>1?(now.getMonth()+1).toString():"0"+(now.getMonth()+1).toString()
      var date = now.getDate().toString().length>1?now.getDate().toString():"0"+now.getDate().toString()
      var hour = now.getHours().toString().length>1?now.getHours().toString():"0"+now.getHours().toString()
      var minute = now.getMinutes().toString().length>1?now.getMinutes().toString():"0"+now.getMinutes().toString()
      var second = now.getSeconds().toString().length>1?now.getSeconds().toString():"0"+now.getSeconds().toString()
      var nowTime = year+month+date+hour+minute+second
      if(nowTime - expireTime >= -10){
        window.location.href = "/admin/login"
      }
    </script>
    <script type="text/javascript">
      $.ajaxSetup({
        contentType:"application/x-www-form-urlencoded;charset=utf-8",
        headers:{
          Authentication:JSON.parse(window.localStorage.getItem("USER_TOKEN"))
        },
        statusCode: {
          404: function() {
            window.location.href="/admin/error/404";
          },
          504: function() {
            window.location.href="/admin/error/default";
          },
          500: function() {
            window.location.href="/admin/error/default";
          },
          429:function () {
            alert("您操作过于频繁！");
          },
          401:function () {
            window.location.href="/admin/error/401";
          },
          400:function () {
            window.location.href="/admin/error/400";
          },
          403:function () {
            window.location.href="/admin/error/403";
          },
        }
      });
      $(document).ready( function() {
        //日历多语言
        var datePikadayLang =  {
          previousMonth : '上一月',
          nextMonth     : '下一月',
          months        : ['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'],
          weekdays      : ['周日','周一','周二','周三','周四','周五','周六'],
          weekdaysShort : ['周日','周一','周二','周三','周四','周五','周六']
        };

        //初始化日历控件
        var $dateForm = $('#dateForm').pikaday({
          firstDay: 1,
          format: 'YYYY-MM-DD',
          minDate: new Date('2000-01-01'),
          maxDate: new Date('2020-12-31'),
          yearRange: [2000,2030],
          i18n: datePikadayLang
        });
        var $dateTo = $('#dateTo').pikaday({
          firstDay: 1,
          format: 'YYYY-MM-DD',
          minDate: new Date('2000-01-01'),
          maxDate: new Date('2020-12-31'),
          yearRange: [2000,2030],
          i18n: datePikadayLang
        });

        //全选
        $(".checkAll").change(function(e) {
          if($(this).is(":checked")){
            $(".checkSimple").each(function(index, element) {
              $(this).attr("checked" , "checked");
            });
          }else{
            $(".checkSimple").each(function(index, element) {
              $(this).removeAttr("checked");
            });
          }
        });
        //选择分类
        $("body").on("click", "#selTypeLink", function(e) {
          e.stopPropagation();
          e.preventDefault();
          showSelType(this);
        });
        //重置表单
        $("#resetBtn").click(function(e) {
          $("form[name=form]")[0].reset();
          $("#selTypeLink span").text("选择部门");
          $("input[name=department_id]").val("")
        });

      });
      //点击搜索
      $("body").on("click", "#searchBtn", function(e) {
        e.stopPropagation();
        e.preventDefault();
        $("#grid-data").bootgrid("reload");
      });

      //显示选择部门对话框
      function showSelType(obj){
        selTypeModal.location.href = "/admin/exam_add/user_sel_dep_multi";
        $('#typeModal').modal({
          backdrop:"static",
          keyboard:false
        });
      }
      //关闭选择分类对话框
      function hideSelDept(obj){
        $('#typeModal').modal('hide');
      }
      //接受选择部门数据
      function selDept(obj){
        var idStr = "";
        var nameStr = "";
        $(obj).each(function(index , element) {
          if (index != obj.length - 1) {
            idStr += element.id + ",";
            nameStr += element.name + ",";
          } else {
            idStr += element.id;
            nameStr += element.name;
          }
        });
        $("input[name=department_id]").val(idStr);
        $("#selTypeLink span").text(nameStr);
      }

      //接受考试选择
      $("#saveBtn").click(function(e) {
        $(".select-box").each(function(index, element) {
          if($(this).is(":checked")){
            var id = $(this).val();
            parent.location.href = "/admin/result/user_mgr_new/?userId="+id
            return;
          }
        });
      });

      //关闭对话框
      $("#closeBtn").click(function(e) {
        parent.hideSelType();
      })
    </script>
    <script>
      function test(){
        $("#grid-data").bootgrid({
          ajax: true,
          ajaxSettings: {
            method:"POST",
            cache: false
          },
          post: function ()
          {
            var sortOrder = $("#grid-data").bootgrid("getSortDictionary");
            var sortKey,sortName;
            var userName = $("input[name=user_name]").val();
            var surname = $("input[name=surname]").val();
            var departmentId = $("input[name=department_id]").val();
            var phone = $("input[name=phone]").val();
            var sex = $("select[name=sex]").find("option:selected").val();
            var status = $("select[name=status]").find("option:selected").val();
            var userName1 = $("input[name=user_name1]").val();
            var position = $("input[name=position]").val();
            var notice = $("input[name=notice]").val();
            var email = $("input[name=email]").val();
            var identity = $("input[name=identity]").val();
            $.each(sortOrder, function (name, value) {
              sortKey = name;
              sortName = value;
            });
            return {
              "sortKey": sortKey,
              "sortName": sortName,
              "userName":userName,
              "surname":surname,
              "departmentId":departmentId,
              "phone":phone,
              "sex":sex,
              "status":status,
              "userName1":userName1,
              "position":position,
              "notice":notice,
              "email":email,
              "identity":identity,
              "account":user.account,
              "companyId":user.companyId
            };
          },
          url: "/api/dept/user_mgr_grid/",
          selection: true,
          multiSelect: false,
          rowSelect: true,
          navigation: 2,
          padding:1,
          formatters: {
            /*
             "id": function(column, row)
             {
             return "";
             },
             "link": function(column, row)
             {
             return "<a href='#' class='table-oper-edit updateExam' examId='"+row.id+"'><em></em>编辑</a><a href='#' class='table-oper-del removeExam' examId='"+row.id+"'><em></em>删除</a>";
             }
             */
          }
        });
      }
      test();
    </script>
  </body>
</html>
